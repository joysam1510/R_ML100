Day007
================

``` r
library(magrittr)
library(tidyverse)
```

``` r
app_train <- read.csv("data/application_train.csv")
head(app_train)
```

    ##   SK_ID_CURR TARGET NAME_CONTRACT_TYPE CODE_GENDER FLAG_OWN_CAR
    ## 1     100002      1         Cash loans           M            N
    ## 2     100003      0         Cash loans           F            N
    ## 3     100004      0    Revolving loans           M            Y
    ## 4     100006      0         Cash loans           F            N
    ## 5     100007      0         Cash loans           M            N
    ## 6     100008      0         Cash loans           M            N
    ##   FLAG_OWN_REALTY CNT_CHILDREN AMT_INCOME_TOTAL AMT_CREDIT AMT_ANNUITY
    ## 1               Y            0           202500   406597.5     24700.5
    ## 2               N            0           270000  1293502.5     35698.5
    ## 3               Y            0            67500   135000.0      6750.0
    ## 4               Y            0           135000   312682.5     29686.5
    ## 5               Y            0           121500   513000.0     21865.5
    ## 6               Y            0            99000   490495.5     27517.5
    ##   AMT_GOODS_PRICE NAME_TYPE_SUITE NAME_INCOME_TYPE
    ## 1          351000   Unaccompanied          Working
    ## 2         1129500          Family    State servant
    ## 3          135000   Unaccompanied          Working
    ## 4          297000   Unaccompanied          Working
    ## 5          513000   Unaccompanied          Working
    ## 6          454500 Spouse, partner    State servant
    ##             NAME_EDUCATION_TYPE   NAME_FAMILY_STATUS NAME_HOUSING_TYPE
    ## 1 Secondary / secondary special Single / not married House / apartment
    ## 2              Higher education              Married House / apartment
    ## 3 Secondary / secondary special Single / not married House / apartment
    ## 4 Secondary / secondary special       Civil marriage House / apartment
    ## 5 Secondary / secondary special Single / not married House / apartment
    ## 6 Secondary / secondary special              Married House / apartment
    ##   REGION_POPULATION_RELATIVE DAYS_BIRTH DAYS_EMPLOYED DAYS_REGISTRATION
    ## 1                   0.018801      -9461          -637             -3648
    ## 2                   0.003541     -16765         -1188             -1186
    ## 3                   0.010032     -19046          -225             -4260
    ## 4                   0.008019     -19005         -3039             -9833
    ## 5                   0.028663     -19932         -3038             -4311
    ## 6                   0.035792     -16941         -1588             -4970
    ##   DAYS_ID_PUBLISH OWN_CAR_AGE FLAG_MOBIL FLAG_EMP_PHONE FLAG_WORK_PHONE
    ## 1           -2120          NA          1              1               0
    ## 2            -291          NA          1              1               0
    ## 3           -2531          26          1              1               1
    ## 4           -2437          NA          1              1               0
    ## 5           -3458          NA          1              1               0
    ## 6            -477          NA          1              1               1
    ##   FLAG_CONT_MOBILE FLAG_PHONE FLAG_EMAIL OCCUPATION_TYPE CNT_FAM_MEMBERS
    ## 1                1          1          0        Laborers               1
    ## 2                1          1          0      Core staff               2
    ## 3                1          1          0        Laborers               1
    ## 4                1          0          0        Laborers               2
    ## 5                1          0          0      Core staff               1
    ## 6                1          1          0        Laborers               2
    ##   REGION_RATING_CLIENT REGION_RATING_CLIENT_W_CITY
    ## 1                    2                           2
    ## 2                    1                           1
    ## 3                    2                           2
    ## 4                    2                           2
    ## 5                    2                           2
    ## 6                    2                           2
    ##   WEEKDAY_APPR_PROCESS_START HOUR_APPR_PROCESS_START
    ## 1                  WEDNESDAY                      10
    ## 2                     MONDAY                      11
    ## 3                     MONDAY                       9
    ## 4                  WEDNESDAY                      17
    ## 5                   THURSDAY                      11
    ## 6                  WEDNESDAY                      16
    ##   REG_REGION_NOT_LIVE_REGION REG_REGION_NOT_WORK_REGION
    ## 1                          0                          0
    ## 2                          0                          0
    ## 3                          0                          0
    ## 4                          0                          0
    ## 5                          0                          0
    ## 6                          0                          0
    ##   LIVE_REGION_NOT_WORK_REGION REG_CITY_NOT_LIVE_CITY
    ## 1                           0                      0
    ## 2                           0                      0
    ## 3                           0                      0
    ## 4                           0                      0
    ## 5                           0                      0
    ## 6                           0                      0
    ##   REG_CITY_NOT_WORK_CITY LIVE_CITY_NOT_WORK_CITY      ORGANIZATION_TYPE
    ## 1                      0                       0 Business Entity Type 3
    ## 2                      0                       0                 School
    ## 3                      0                       0             Government
    ## 4                      0                       0 Business Entity Type 3
    ## 5                      1                       1               Religion
    ## 6                      0                       0                  Other
    ##   EXT_SOURCE_1 EXT_SOURCE_2 EXT_SOURCE_3 APARTMENTS_AVG BASEMENTAREA_AVG
    ## 1   0.08303697    0.2629486    0.1393758         0.0247           0.0369
    ## 2   0.31126731    0.6222458           NA         0.0959           0.0529
    ## 3           NA    0.5559121    0.7295667             NA               NA
    ## 4           NA    0.6504417           NA             NA               NA
    ## 5           NA    0.3227383           NA             NA               NA
    ## 6           NA    0.3542247    0.6212263             NA               NA
    ##   YEARS_BEGINEXPLUATATION_AVG YEARS_BUILD_AVG COMMONAREA_AVG ELEVATORS_AVG
    ## 1                      0.9722          0.6192         0.0143          0.00
    ## 2                      0.9851          0.7960         0.0605          0.08
    ## 3                          NA              NA             NA            NA
    ## 4                          NA              NA             NA            NA
    ## 5                          NA              NA             NA            NA
    ## 6                          NA              NA             NA            NA
    ##   ENTRANCES_AVG FLOORSMAX_AVG FLOORSMIN_AVG LANDAREA_AVG
    ## 1        0.0690        0.0833        0.1250       0.0369
    ## 2        0.0345        0.2917        0.3333       0.0130
    ## 3            NA            NA            NA           NA
    ## 4            NA            NA            NA           NA
    ## 5            NA            NA            NA           NA
    ## 6            NA            NA            NA           NA
    ##   LIVINGAPARTMENTS_AVG LIVINGAREA_AVG NONLIVINGAPARTMENTS_AVG
    ## 1               0.0202         0.0190                  0.0000
    ## 2               0.0773         0.0549                  0.0039
    ## 3                   NA             NA                      NA
    ## 4                   NA             NA                      NA
    ## 5                   NA             NA                      NA
    ## 6                   NA             NA                      NA
    ##   NONLIVINGAREA_AVG APARTMENTS_MODE BASEMENTAREA_MODE
    ## 1            0.0000          0.0252            0.0383
    ## 2            0.0098          0.0924            0.0538
    ## 3                NA              NA                NA
    ## 4                NA              NA                NA
    ## 5                NA              NA                NA
    ## 6                NA              NA                NA
    ##   YEARS_BEGINEXPLUATATION_MODE YEARS_BUILD_MODE COMMONAREA_MODE
    ## 1                       0.9722           0.6341          0.0144
    ## 2                       0.9851           0.8040          0.0497
    ## 3                           NA               NA              NA
    ## 4                           NA               NA              NA
    ## 5                           NA               NA              NA
    ## 6                           NA               NA              NA
    ##   ELEVATORS_MODE ENTRANCES_MODE FLOORSMAX_MODE FLOORSMIN_MODE
    ## 1         0.0000         0.0690         0.0833         0.1250
    ## 2         0.0806         0.0345         0.2917         0.3333
    ## 3             NA             NA             NA             NA
    ## 4             NA             NA             NA             NA
    ## 5             NA             NA             NA             NA
    ## 6             NA             NA             NA             NA
    ##   LANDAREA_MODE LIVINGAPARTMENTS_MODE LIVINGAREA_MODE
    ## 1        0.0377                 0.022          0.0198
    ## 2        0.0128                 0.079          0.0554
    ## 3            NA                    NA              NA
    ## 4            NA                    NA              NA
    ## 5            NA                    NA              NA
    ## 6            NA                    NA              NA
    ##   NONLIVINGAPARTMENTS_MODE NONLIVINGAREA_MODE APARTMENTS_MEDI
    ## 1                        0                  0          0.0250
    ## 2                        0                  0          0.0968
    ## 3                       NA                 NA              NA
    ## 4                       NA                 NA              NA
    ## 5                       NA                 NA              NA
    ## 6                       NA                 NA              NA
    ##   BASEMENTAREA_MEDI YEARS_BEGINEXPLUATATION_MEDI YEARS_BUILD_MEDI
    ## 1            0.0369                       0.9722           0.6243
    ## 2            0.0529                       0.9851           0.7987
    ## 3                NA                           NA               NA
    ## 4                NA                           NA               NA
    ## 5                NA                           NA               NA
    ## 6                NA                           NA               NA
    ##   COMMONAREA_MEDI ELEVATORS_MEDI ENTRANCES_MEDI FLOORSMAX_MEDI
    ## 1          0.0144           0.00         0.0690         0.0833
    ## 2          0.0608           0.08         0.0345         0.2917
    ## 3              NA             NA             NA             NA
    ## 4              NA             NA             NA             NA
    ## 5              NA             NA             NA             NA
    ## 6              NA             NA             NA             NA
    ##   FLOORSMIN_MEDI LANDAREA_MEDI LIVINGAPARTMENTS_MEDI LIVINGAREA_MEDI
    ## 1         0.1250        0.0375                0.0205          0.0193
    ## 2         0.3333        0.0132                0.0787          0.0558
    ## 3             NA            NA                    NA              NA
    ## 4             NA            NA                    NA              NA
    ## 5             NA            NA                    NA              NA
    ## 6             NA            NA                    NA              NA
    ##   NONLIVINGAPARTMENTS_MEDI NONLIVINGAREA_MEDI FONDKAPREMONT_MODE
    ## 1                   0.0000               0.00   reg oper account
    ## 2                   0.0039               0.01   reg oper account
    ## 3                       NA                 NA                   
    ## 4                       NA                 NA                   
    ## 5                       NA                 NA                   
    ## 6                       NA                 NA                   
    ##   HOUSETYPE_MODE TOTALAREA_MODE WALLSMATERIAL_MODE EMERGENCYSTATE_MODE
    ## 1 block of flats         0.0149       Stone, brick                  No
    ## 2 block of flats         0.0714              Block                  No
    ## 3                            NA                                       
    ## 4                            NA                                       
    ## 5                            NA                                       
    ## 6                            NA                                       
    ##   OBS_30_CNT_SOCIAL_CIRCLE DEF_30_CNT_SOCIAL_CIRCLE
    ## 1                        2                        2
    ## 2                        1                        0
    ## 3                        0                        0
    ## 4                        2                        0
    ## 5                        0                        0
    ## 6                        0                        0
    ##   OBS_60_CNT_SOCIAL_CIRCLE DEF_60_CNT_SOCIAL_CIRCLE DAYS_LAST_PHONE_CHANGE
    ## 1                        2                        2                  -1134
    ## 2                        1                        0                   -828
    ## 3                        0                        0                   -815
    ## 4                        2                        0                   -617
    ## 5                        0                        0                  -1106
    ## 6                        0                        0                  -2536
    ##   FLAG_DOCUMENT_2 FLAG_DOCUMENT_3 FLAG_DOCUMENT_4 FLAG_DOCUMENT_5
    ## 1               0               1               0               0
    ## 2               0               1               0               0
    ## 3               0               0               0               0
    ## 4               0               1               0               0
    ## 5               0               0               0               0
    ## 6               0               1               0               0
    ##   FLAG_DOCUMENT_6 FLAG_DOCUMENT_7 FLAG_DOCUMENT_8 FLAG_DOCUMENT_9
    ## 1               0               0               0               0
    ## 2               0               0               0               0
    ## 3               0               0               0               0
    ## 4               0               0               0               0
    ## 5               0               0               1               0
    ## 6               0               0               0               0
    ##   FLAG_DOCUMENT_10 FLAG_DOCUMENT_11 FLAG_DOCUMENT_12 FLAG_DOCUMENT_13
    ## 1                0                0                0                0
    ## 2                0                0                0                0
    ## 3                0                0                0                0
    ## 4                0                0                0                0
    ## 5                0                0                0                0
    ## 6                0                0                0                0
    ##   FLAG_DOCUMENT_14 FLAG_DOCUMENT_15 FLAG_DOCUMENT_16 FLAG_DOCUMENT_17
    ## 1                0                0                0                0
    ## 2                0                0                0                0
    ## 3                0                0                0                0
    ## 4                0                0                0                0
    ## 5                0                0                0                0
    ## 6                0                0                0                0
    ##   FLAG_DOCUMENT_18 FLAG_DOCUMENT_19 FLAG_DOCUMENT_20 FLAG_DOCUMENT_21
    ## 1                0                0                0                0
    ## 2                0                0                0                0
    ## 3                0                0                0                0
    ## 4                0                0                0                0
    ## 5                0                0                0                0
    ## 6                0                0                0                0
    ##   AMT_REQ_CREDIT_BUREAU_HOUR AMT_REQ_CREDIT_BUREAU_DAY
    ## 1                          0                         0
    ## 2                          0                         0
    ## 3                          0                         0
    ## 4                         NA                        NA
    ## 5                          0                         0
    ## 6                          0                         0
    ##   AMT_REQ_CREDIT_BUREAU_WEEK AMT_REQ_CREDIT_BUREAU_MON
    ## 1                          0                         0
    ## 2                          0                         0
    ## 3                          0                         0
    ## 4                         NA                        NA
    ## 5                          0                         0
    ## 6                          0                         0
    ##   AMT_REQ_CREDIT_BUREAU_QRT AMT_REQ_CREDIT_BUREAU_YEAR
    ## 1                         0                          1
    ## 2                         0                          0
    ## 3                         0                          0
    ## 4                        NA                         NA
    ## 5                         0                          0
    ## 6                         1                          1

處理outliers
------------

-   新增欄位註記
-   outliers 或 NA 填補
-   平均數 (mean)
-   中位數 (median, or Q50)
-   最大/最小值 (max/min, Q100, Q0)
-   分位數 (quantile)

連續值標準化
------------

1.  Z-transform: (x−mean(x)) / sd(x)
2.  Range (0 ~ 1): (x−min(x)) / (x−min(x))
3.  Range (-1 ~ 1): 2 \* {\[(x−min(x)) / (max(x)−min(x))\] − 0.5}

HW
--

1.  列出 AMT\_ANNUITY 的 q0 - q100

``` r
probs <- (0:100)/100
quantile(app_train$AMT_ANNUITY, probs = probs, na.rm = TRUE) %>%
  as.data.frame() %>% set_colnames("AMT_ANNUITY")
```

    ##      AMT_ANNUITY
    ## 0%       1615.50
    ## 1%       6182.91
    ## 2%       6750.00
    ## 3%       7875.00
    ## 4%       8703.00
    ## 5%       9000.00
    ## 6%       9000.00
    ## 7%       9553.50
    ## 8%      10125.00
    ## 9%      10503.00
    ## 10%     11074.50
    ## 11%     11430.00
    ## 12%     11970.00
    ## 13%     12375.00
    ## 14%     12838.50
    ## 15%     13302.00
    ## 16%     13500.00
    ## 17%     13500.00
    ## 18%     13896.00
    ## 19%     14350.50
    ## 20%     14701.50
    ## 21%     15124.50
    ## 22%     15583.50
    ## 23%     15970.50
    ## 24%     16209.00
    ## 25%     16524.00
    ## 26%     16852.50
    ## 27%     17109.00
    ## 28%     17487.00
    ## 29%     17806.50
    ## 30%     18189.00
    ## 31%     18643.50
    ## 32%     19102.50
    ## 33%     19417.50
    ## 34%     19836.00
    ## 35%     20151.00
    ## 36%     20421.00
    ## 37%     20853.00
    ## 38%     21186.00
    ## 39%     21609.00
    ## 40%     21865.50
    ## 41%     22018.50
    ## 42%     22342.50
    ## 43%     22527.00
    ## 44%     22972.50
    ## 45%     23346.00
    ## 46%     23719.50
    ## 47%     23931.00
    ## 48%     24259.50
    ## 49%     24583.59
    ## 50%     24903.00
    ## 51%     25240.50
    ## 52%     25537.50
    ## 53%     25960.50
    ## 54%     26217.00
    ## 55%     26316.00
    ## 56%     26640.00
    ## 57%     26860.50
    ## 58%     27189.00
    ## 59%     27558.00
    ## 60%     28062.00
    ## 61%     28480.50
    ## 62%     28917.00
    ## 63%     29340.00
    ## 64%     29830.50
    ## 65%     30078.00
    ## 66%     30483.00
    ## 67%     30897.00
    ## 68%     31275.00
    ## 69%     31630.50
    ## 70%     32004.00
    ## 71%     32458.50
    ## 72%     32895.00
    ## 73%     33376.50
    ## 74%     33984.00
    ## 75%     34596.00
    ## 76%     35345.16
    ## 77%     35806.50
    ## 78%     36328.50
    ## 79%     36747.00
    ## 80%     37516.50
    ## 81%     37948.50
    ## 82%     38556.00
    ## 83%     39456.00
    ## 84%     40135.50
    ## 85%     40806.00
    ## 86%     41845.50
    ## 87%     42790.50
    ## 88%     43735.50
    ## 89%     44991.00
    ## 90%     45954.00
    ## 91%     47254.50
    ## 92%     48465.00
    ## 93%     49878.00
    ## 94%     51745.50
    ## 95%     53325.00
    ## 96%     55624.50
    ## 97%     58482.00
    ## 98%     62964.00
    ## 99%     70006.50
    ## 100%   258025.50

2.1 將 AMT\_ANNUITY 中的 NAs 暫時以中位數填補

``` r
cat(paste("Before replace NAs, numbers of row that AMT_ANNUITY is NAs:", sum(is.na(app_train$AMT_ANNUITY))));
```

    ## Before replace NAs, numbers of row that AMT_ANNUITY is NAs: 12

``` r
q50 <- quantile(app_train$AMT_ANNUITY, probs = 0.5, na.rm = TRUE)
app_train$AMT_ANNUITY[is.na(app_train$AMT_ANNUITY)] <- q50

cat(paste("After replace NAs, numbers of row that AMT_ANNUITY is NAs:", sum(is.na(app_train$AMT_ANNUITY))))
```

    ## After replace NAs, numbers of row that AMT_ANNUITY is NAs: 0

2.2 將 AMT\_ANNUITY 的數值標準化至 -1 ~ 1 間

Original data range

``` r
app_train$AMT_ANNUITY %>% summary
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##    1616   16524   24903   27108   34596  258026

``` r
normaliza_value <- function(x) {
  ((x - min(x)) / (max(x) - min(x)) - .5) * 2
}

app_train <- app_train %>%
  mutate(AMT_ANNUITY_NORMALIZED = normaliza_value(AMT_ANNUITY))
```

Normalized data range

``` r
app_train$AMT_ANNUITY_NORMALIZED %>% summary
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ## -1.0000 -0.8837 -0.8184 -0.8012 -0.7428  1.0000

1.  將 AMT\_GOOD\_PRICE 的 NAs 以眾數填補

``` r
cat(paste("Before replace NAs, numbers of row that AMT_GOODS_PRICE is NAs:", sum(is.na(app_train$AMT_GOODS_PRICE))))
```

    ## Before replace NAs, numbers of row that AMT_GOODS_PRICE is NAs: 278

``` r
app_train$AMT_GOODS_PRICE %>%
  table %>%
  sort(decreasing = TRUE) %>%
  head
```

    ## .
    ## 450000 225000 675000  9e+05 270000 180000 
    ##  26022  25282  24962  15416  11428  10123

``` r
value_most <- app_train$AMT_GOODS_PRICE %>%
  table %>%
  which.max %>%
  names %>% 
  as.numeric

app_train$AMT_GOODS_PRICE[is.na(app_train$AMT_GOODS_PRICE)] <- value_most
```

``` r
cat(paste("After replace NAs, numbers of row that AMT_GOODS_PRICE is NAs:", sum(is.na(app_train$AMT_GOODS_PRICE))))
```

    ## After replace NAs, numbers of row that AMT_GOODS_PRICE is NAs: 0
